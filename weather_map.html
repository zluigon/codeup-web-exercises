<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Weather Map</title>
	
	<!--Bootstrap-->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
	      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
	
	<!--jQuery-->
	<script src="https://code.jquery.com/jquery-3.6.4.min.js"
	        integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
	
	<!--Mapbox-->
	<script src='https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.js'></script>
	<link href='https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.css' rel='stylesheet'/>
	
	<style>
		* {
			padding: 0;
			margin: 0;
			box-sizing: border-box;
		}
		
		.card {
			background-color: #b4d455;
		}
	</style>

</head>
<body>

<nav class="navbar bg-primary pb-0">
	<div class="container-fluid d-flex justify-between">
		<span class="navbar-brand fs-1 text-light">WeatherMap</span>
		<span class="navbar-brand fs-5 text-light" id="currentLocation"></span>
	</div>
</nav>

<section
		class="mb-3 main-heading container-fluid d-flex justify-content-evenly align-items-center text-center">
	<div class="left-heading">
		<h5>Current Locale:</h5>
	</div>
	<div class="center-heading input-group justify-content-center">
		<h1>It da weather</h1>
		<div class="input-group">
			<input class="form-control" type="text" placeholder="Enter a City, State" id="searchInput">
			<button class="btn btn-outline-primary" id="myBtn">Search</button>
		</div>
	</div>
	<div class="right-heading">
		<h3>Weather Warning</h3>
	</div>
</section>

<section class="main-body">
	<div class="cards container-fluid">
		
		<div class="row">
			<div class="current col">
				<div class="card mb-3">
					<div class="card-body ">
						<div id="current-weather"></div>
					</div>
				</div>
			</div>
		</div>
		
		
		<div class="row">
			<div class="second-day col-6 col-md-3">
				<div class="card mb-3">
					<div class="card-body text-center">
						<div id="day-1"></div>
					</div>
				</div>
			</div>
			<div class="third-day col-6 col-md-3">
				<div class="card mb-3">
					<div class="card-body text-center">
						<div id="day-2"></div>
					</div>
				</div>
			</div>
			<div class="fourth-day col-6 col-md-3">
				<div class="card mb-3">
					<div class="card-body text-center">
						<div id="day-3"></div>
					</div>
				</div>
			</div>
			<div class="fifth-day col-6 col-md-3">
				<div class="card mb-3">
					<div class="card-body text-center">
						<div id="day-4"></div>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>

<section class="container-fluid mapbox p-0">
	<div id='map' style='width: 100%; height: 300px;'></div>
</section>

<div id="weatherBody"></div>

<div id="forecastBody"></div>


<!--JS Scripts-->
<!--keys-->
<script src="js/keys.js"></script>

<!--Bootstrap-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
        crossorigin="anonymous"></script>


<script src="js/mapbox-geocoder-utils.js"></script>

<script>
	// (function () {
	"use strict";
	
	$(document).ready(function () {
		
		mapboxgl.accessToken = MAPBOX_KEY;
		
		const map = new mapboxgl.Map({
			container: 'map', // container ID
			style: 'mapbox://styles/mapbox/streets-v12', // style URL
			center: [-74.11, 40.98], // starting position [lng, lat]
			zoom: 5, // starting zoom
		});
		
		let weatherLocale = {
			lat: 40.98,
			lon: -74.11,
			appid: OPEN_WEATHER_APPID,
			units: "imperial"
		}
		
		const marker = new mapboxgl.Marker({
			draggable: true
		})
				.setLngLat([-74.11, 40.98])
				.addTo(map);
		
		function onDragEnd() {
			const lngLat = marker.getLngLat();
			console.log(`Longitude: ${lngLat.lng}, Latitude: ${lngLat.lat}`);
			let lat = lngLat.lat
			let lng = lngLat.lng
			console.log(lngLat);
			weatherLocale.lon = lng
			weatherLocale.lat = lat
		}
		
		marker.on('dragend', onDragEnd);
		
		$("#myBtn").click(function (e) {
			e.preventDefault();
			let userInput = $("#searchInput").val();
			console.log(userInput);
			geocode(userInput, MAPBOX_KEY).then(function (results) {
				console.log(results[0]); //lon
				console.log(results[1]); //lat
				weatherLocale.lon = results[0]
				weatherLocale.lat = results[1]
				buildWeather();
			});
		});
		
		function buildWeather() {
			
			$.get("http://api.openweathermap.org/data/3.0/onecall", weatherLocale)
					.done(function (data) {
						console.log(data);
						console.log(data.current.temp);
						console.log(data.daily[0].weather[0].icon);
						
						function parseDate(timestamp) {
							return new Date(timestamp * 1000).toLocaleDateString();
						}
						
						let dayOneDate = parseDate(data.daily[0].dt); //current day
						let dayTwoDate = parseDate(data.daily[1].dt)
						let dayThreeDate = parseDate(data.daily[2].dt)
						let dayFourDate = parseDate(data.daily[3].dt)
						let dayFiveDate = parseDate(data.daily[4].dt)
						
						$("#current-weather").html(`<h4>Today's Weather: ${dayOneDate}</h4>
													<h4>${data.current.weather[0].main},  ${Math.floor(data.current.temp)}&deg;</h4>
													<img src="http://openweathermap.org/img/w/${data.current.weather[0].icon}.png">
													<h5>H: ${Math.floor(data.daily[0].temp.max)}&deg;, L: ${Math.floor(data.daily[0].temp.min)}&deg; </h5>`);
						$("#day-1").html(`<h4>${dayTwoDate}</h4>
													<h4>${data.daily[1].weather[0].main},  ${Math.floor(data.current.temp)}&deg;</h4>
													<img src="http://openweathermap.org/img/w/${data.daily[1].weather[0].icon}.png">
													<h5>H: ${Math.floor(data.daily[1].temp.max)}&deg;, L: ${Math.floor(data.daily[1].temp.min)}&deg; </h5>`);
						$("#day-2").html(`<h4>${dayThreeDate}</h4>
													<h4>${data.daily[2].weather[0].main},  ${Math.floor(data.current.temp)}&deg;</h4>
													<img src="http://openweathermap.org/img/w/${data.daily[2].weather[0].icon}.png">
													<h5>H: ${Math.floor(data.daily[2].temp.max)}&deg;, L: ${Math.floor(data.daily[2].temp.min)}&deg; </h5>`);
						$("#day-3").html(`<h4>${dayFourDate}</h4>
													<h4>${data.daily[3].weather[0].main},  ${Math.floor(data.current.temp)}&deg;</h4>
													<img src="http://openweathermap.org/img/w/${data.daily[3].weather[0].icon}.png">
													<h5>H: ${Math.floor(data.daily[3].temp.max)}&deg;, L: ${Math.floor(data.daily[3].temp.min)}&deg; </h5>`);
						$("#day-4").html(`<h4>${dayFiveDate}</h4>
													<h4>${data.daily[4].weather[0].main},  ${Math.floor(data.current.temp)}&deg;</h4>
													<img src="http://openweathermap.org/img/w/${data.daily[4].weather[0].icon}.png">
													<h5>H: ${Math.floor(data.daily[4].temp.max)}&deg;, L: ${Math.floor(data.daily[4].temp.min)}&deg; </h5>`);
						
						
					});
		}
		buildWeather([-74.11, 40.98]);
	});
	// })();
	
	
	// $.get("http://api.openweathermap.org/data/2.5/weather", weatherLocale).done(function (data) {
	// 	// const marker = new mapboxgl.Marker({
	// 	// 	draggable: true
	// 	// })
	// 	// 		.setLngLat(results)
	// 	// 		.addTo(map);
	// 	//
	// 	// map.flyTo({
	// 	// 	center: results,
	// 	// 	zoom: 10
	// 	// })
	// 	let html = "";
	// 	html += `<h4>Current location: ${data.name}</h4>`;
	// 	html += `<h4>Current weather: ${data.weather[0].description}</h4>`;
	// 	html += `<h5>Current average wind speed: ${parseInt(data.wind.speed)} knots</h5>`;
	// 	html += `<h5>Current Temperature: ${parseInt(data.main.temp)} &deg;</h5>`;
	// 	html += `<h5>Current humidity: ${parseInt(data.main.humidity)}</h5>`;
	//
	// 	$("#weatherBody").html(html);
	// 	$("#currentLocation").text(`Current location: ${$("#searchInput").val()}`);
	// });
</script>


</body>
</html>