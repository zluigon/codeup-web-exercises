<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Weather Map</title>
	
	<!--Bootstrap-->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
	      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
	
	<!--jQuery-->
	<script src="https://code.jquery.com/jquery-3.6.4.min.js"
	        integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
	
	<!--Mapbox-->
	<script src='https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.js'></script>
	<link href='https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.css' rel='stylesheet'/>
	
	<style>
		* {
			padding: 0;
			margin: 0;
		}
	</style>

</head>
<body>

<nav class="navbar bg-primary pb-0">
	<div class="container-fluid d-flex justify-between">
		<span class="navbar-brand fs-1 text-light">WeatherMap</span>
		<span class="navbar-brand fs-5 text-light" id="currentLocation"></span>
	</div>
</nav>

<section
		class="main-heading container-fluid border border-primary border-3 d-flex justify-content-evenly align-items-center text-center">
	<div class="left-heading">
		<h3>Current Locale:</h3>
	</div>
	<div class="center-heading input-group justify-content-center">
		<h1>It da weather</h1>
		<div class="input-group">
			<input class="form-control" type="text" placeholder="Enter a City, State" id="searchInput">
			<button class="btn btn-outline-primary" id="myBtn">Search</button>
		</div>
	</div>
	<div class="right-heading">
		<h3>Weather Warning</h3>
	</div>
</section>

<section class="main-body  border border-success border-3">
	<div class="cards container-fluid">
		<div class="row mx-auto">
			<div class="current col-md-4">
				<div class="card">
					<div class="card-body"><p>tuday</p></div>
				</div>
			</div>
			<div class="second-day col-3 col-md-2">
				<div class="card">
					<div class="card-body"><p>2mroo</p></div>
				</div>
			</div>
			<div class="third-day col-3 col-md-2">
				<div class="card">
				<div class="card-body"><p>next dai</p></div>
			</div>
			</div>
			<div class="fourth-day col-3 col-md-2">
				<div class="card">
					<div class="card-body"><p>after dat</p></div>
				</div>
			</div>
			<div class="fifth-day col-3 col-md-2">
				<div class="card">
					<div class="card-body"><p>last dei</p></div>
				</div>
			</div>
		</div>
	</div>
</section>

<section class="container-fluid mapbox border border-danger border-3 p-0">
	<div id='map' style='width: 100%; height: 300px;'></div>
</section>

<div id="weatherBody"></div>

<div id="forecastBody"></div>


<!--JS Scripts-->
<!--keys-->
<script src="js/keys.js"></script>

<!--Bootstrap-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
        crossorigin="anonymous"></script>


<script src="js/mapbox-geocoder-utils.js"></script>

<script>
	mapboxgl.accessToken = MAPBOX_KEY;
	
	const map = new mapboxgl.Map({
		container: 'map', // container ID
		style: 'mapbox://styles/mapbox/streets-v12', // style URL
		center: [-74.11, 40.98], // starting position [lng, lat]
		zoom: 12, // starting zoom
	});
</script>


<!--Custom JS-->
<script>
	// (function () {
	
	function buildWeather(searchString) {
		geocode(searchString, MAPBOX_KEY).then(function (results) {
			console.log(results[0]); //lat
			console.log(results[1]); //lon
			
			$.get("http://api.openweathermap.org/data/2.5/weather", {
				APPID: OPEN_WEATHER_APPID,
				lat: results[1],
				lon: results[0],
				units: "imperial"
			}).done(function (data) {
				let html = "";
				html += `<h4>Current location: ${$("#searchInput").val()}</h4>`;
				html += `<h4>Current weather: ${data.weather[0].description}</h4>`;
				html += `<h5>Current average wind speed: ${parseInt(data.wind.speed)} knots</h5>`;
				html += `<h5>Current Temperature: ${parseInt(data.main.temp)} &deg;</h5>`;
				html += `<h5>Current humidity: ${parseInt(data.main.humidity)}</h5>`;
				
				$("#weatherBody").html(html);
				$("#currentLocation").text(`Current location: ${$("#searchInput").val()}`);
			});
			
			$.get("http://api.openweathermap.org/data/3.0/onecall", {
				APPID: OPEN_WEATHER_APPID,
				lat: results[1],
				lon: results[0],
				units: "imperial",
				lang: "en"
			}).done(function (data) {
				let html = ""
				for (i = 1; i <= 5; i++) {
					html += `<h3> ${i}'s forecasted high is: ${parseInt(data.daily[i].temp.day)}`;
					console.log('The entire response:', data);
				}
				$("#forecastBody").html(html);
			});
		});
	}
	
	$("#myBtn").click(function (e) {
		e.preventDefault();
		buildWeather($("#searchInput").val());
	})
	// })();
</script>


</body>
</html>